（1）大家好，我是23级的张梓卫。目前，LLM，即大语言模型，近年来在世界各地火热传播，一位在日本工作的机器学习工程师与我说：“现在市场上是个软件就得说自己用了 AI，不然不好意思提供服务了”，此句稍带滑稽的话语让我萌生了使用LLM的念头。Arduino Nano板在使用时，显然有有线、短距离的限制，不够智能、功能局限也是痛点。ESP32具有Wifi连接功能，于是我就想，能不能连接到互联网呢？能不能实现全国互联呢？

至于在本页标题中所写的“各模块集成”还有“拓展”二字，请待我一会娓娓道来。

（2）下面是本次项目演示的主体框架，我将着重说明Progress部分。

（3）项目难点如下所示，其中ESP-NOW协议是我很想和大家分享的协议，因为，我的项目中有主机和从机两个部分，这两个部分是通过无线连接的，甚至通信距离可以覆盖整个房间。那么，我们正式进入第一块大内容。

（4）以下是本项目所需要用到的硬件物料，我使用的是ESP32开发板进行开发，调试的过程也使用到了ESP8266。

（5）第一块，语音识别与大模型模块。在Github上，有高手开发了Arduino框架的Websocket协议库，使得我们能够轻松调用，我使用INMP441麦克风，以及开源的ESPAudio库，通过I2S接口传输给ESP32，它通过接收模拟声波通过内部的模数转换器，即ADC将其转化为数字信号，获得PCM格式的未压缩的数字音频，然后编码为base64，与讯飞大模型进行鉴权，完成一次握手后建立全双工通信，实时流式传输语音信息。


（6）尔后建立与星火大模型的Websocket连接，发送JSON数据至云端，获取返回的数据。
大模型的返回以标点符号作为分割，因为流式返回是实时返回，不需要等待太久时间，所以我们可以使用动态JSON对象以及动态Vector存储LLM返回的字符串。

获取了大模型返回的文本，之后便是发声了，这一部分我借鉴了开源的ESPAudio项目，因为它涉及到mp3、wav格式二进制头的构造，我本人没有办法实现，注意到他里面有一个接口直接写好了与openAI对接的，只需要魔改成百度的TTS服务即可，这里用的是MAX98357音频信号放大器，再接上一个喇叭便可以完成发声。

到此，我们已经实现了智能场景，我们可以添加各种关键词，为不同的场景注入AI，如开灯、开风扇等指令，外接红外线发射器，也可以完成开电视、开空调各种各样的操作。

下一步，如果我们不在家中，怎样远程进行控制呢？

（7）MQTT 服务器的搭建

中国移动的OneNET平台是一个很不错的选择，MQTT协议分为订阅和发布两个操作，顾名思义其实就是数据的上传和下载，对于ESP家族来说，物联网就是它的经典，ESP32与ESP8266都是用来做物联网的典范，所ESP32以也有人实现了相关的库，PubSubClient就是其中之一，同样实现鉴权、连接产品ID、产品Access，使用MHAC-SHA256算法生成唯一Token，就可以连接到MQTT服务器，在服务器中，我们可以实时获取数据，如下面这张图片所示。

（8）
你可以看到房间的光照强度、湿度、温度等信息，当然还有火焰传感器和雨滴传感器检测室内的状态，烟雾浓度等，可以通过设置不同的阈值来实现家中报警的效果，也就是加一个蜂鸣器的事情了，这些数据都通过传感器实时获取。因为我外接的是MQ135和MQ5模块，你还可以选择获取二氧化碳和一氧化碳的浓度、氢气的浓度，酒精的浓度，甚至各种可燃物的浓度，保证家中的煤气安全。

（9）
只有电脑端显然不够，我使用手机端通过Nodejs + 微信开发者工具开发了一个小程序，小程序中使用MQTT协议的函数连接到云端服务器，实时获取JSON数据并解析获取信息，当然，由于时间关系，我尚未添加一些按钮使得能够远程操作家中的设施，当然也只是设置一个接口的事情，主体框架有了，调用函数，当然就是简单的事情了。

（10）
ESP-NOW协议是本次实现短距离通信的主要来源，EPS-NOW是乐鑫公司自己定义的协议，基于WiFi模块，但又不是Wifi，它既可以作为接入点，也可以作为接收点。所以，你可以用这个定义一个伪AC + AP的组网模式，甚至可以外加I2C、SPI等通信协议当成Mesh组网模式。

我设置了两个设备，主机和从机实现无线互联。也就意味着，各种传感器可以通过一个包装塞在角落之中，不影响房间的美观，同时你可以把语音和大模型模块封装成一个小装置，拿在手上就可以实现获取房间内各种信息的对话，你可以通过自己定义的接口获取房间内的温度、湿度，还有任何你想知道的信息，这些可以通过演示视频来查看。未来，我打算使用OV摄像头模块，通过Yolo算法获取室内的人员信息。

（11）
ESP32的Wifi之强大，你可能无法想象。南京大学无线感知前沿技术论坛在8月1日分享了CSI的前沿研究成果，有望实现毫米级的动态感应。这一部分已有人通过算法实现，原理如同切割磁感线一般，可以通过Wifi强度在人为动作后感应信道的变化，从而读取人类活动，应用前景广泛，和同学聊过之后，他觉得很可能可以在未来老人跌倒检测、无声检测人类活动方面带来巨大的收益。

（Final）好的，今天我想分享的内容就到此结束了，谢谢大家的聆听。